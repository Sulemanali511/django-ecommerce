{% extends "base.html" %}
{% load i18n static %}

{% block our_heard %}
    <style>
        .toast {
          position: fixed;
          top: 15px;
          right: 15px;
          z-index: 9999;
        }

        .bootstrap-basic {
          background: white;
        }

        /* Braintree Hosted Fields styling classes*/
        .braintree-hosted-fields-focused {
          color: #495057;
          background-color: #fff;
          border-color: #80bdff;
          outline: 0;
          box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        .braintree-hosted-fields-focused.is-invalid {
          border-color: #dc3545;
          box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
        }
    </style>
{% endblock our_heard %}
{% block carousel %}{% endblock carousel %}

{% block content %}
    <!-- Main product Layout View -->
    <main class="mt-5 pt-4">
        <div class="container wow fadeIn">
            <!-- Bootstrap inspired Braintree Hosted Fields example -->
            <h2 class="my-5 h2 text-center text-uppercase">{% trans "payment" %}</h2>
            <div class="row">
                <div class="col-md-12 mb-4">
                    <div class="">
                        <form action="." id="payment" method="post">
                            <div class="row">
                                <div class="col-sm-6 mb-3">
                                    <label for="cc-number">
                                    {% trans "Credit card number" %}</label>
                                    <div class="form-control" id="cc-number"></div>
                                    <div class="invalid-feedback">
                                      {% trans "Credit card number is required" %}
                                    </div>
                                </div>

                                <div class="col-sm-3 mb-3">
                                    <label for="cc-expiration">{% trans "expiration Date" %}</label>
                                    <div class="form-control" id="cc-expiration"></div>
                                    <div class="invalid-feedback">
                                      {% trans "expiration date required" %}
                                    </div>
                                </div>
                                <div class="col-sm-3 mb-3">
                                    <label for="cc-expiration">{% trans "CVV" %}</label>
                                    <div class="form-control" id="cc-cvv"></div>
                                    <div class="invalid-feedback">
                                      {% trans "security code required" %}
                                    </div>
                                </div>
                            </div>

                            <hr class="mb-4">
                            <input type="hidden" name="payment_method_nonce" id="nonce" value="">
                            {% csrf_token %}
                            <div class="text-center">
                                <button class="btn btn-primary btn-lg" type="submit">
                                   {% trans " pay with" %} <span id="card-brand">{% trans "card" %}</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <div aria-live="polite" aria-atomic="true" style="position: relative; min-height: 200px;">
                    <div class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-autohide="false">
                        <div class="toast-header">
                            <strong class="mr-auto">{% trans "Success" %} !</strong>
                            <small>{% trans "Just now" %}</small>
                            <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>

                        <div class="toast-body">
                            {% trans "Next, submit the payment method nonce to your server." %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <!-- Load the required client component. -->
    <script src="https://js.braintreegateway.com/web/3.50.0/js/client.min.js"></script>

    <!-- Load Hosted Fields component. -->
    <script src="https://js.braintreegateway.com/web/3.50.0/js/hosted-fields.min.js"></script>

    <script>
        var form = document.querySelector('#payment');
        var submit = document.querySelector('input[type="submit"]');

        braintree.client.create({
            authorization: '{{ client_token }}'
        }, function(err, clientInstance) {
            if (err) {
                console.error(err);
                return;
            }

            braintree.hostedFields.create({
                client: clientInstance,
                styles: {
                    'input': {'font-size': '13px'},
                    'input.invalid': {'color': 'red'},
                    'input.valid': {'color': 'green'}
                },

                fields: {
                    number: {
                        selector: '#cc-number',
                        placeholder: '4111 1111 1111 1111'
                    },
                    cvv: {
                        selector: '#cc-cvv',
                        placeholder: '123'
                    },
                    expirationDate: {
                        selector: '#cc-expiration',
                        placeholder: 'MM / YY'
                    }
                }
            }, function(err, hostedFieldsInstance) {
                if (err) {
                  console.error(err);
                  return;
                }

                submit.removeAttribute('disabled');

                form.addEventListener('submit', function(event) {
                    event.preventDefault();

                    hostedFieldsInstance.tokenize(function (tokenizeErr, payload) {
                        if (tokenizeErr) {
                            console.error(tokenizeErr);
                            return;
                        }

                        document.getElementById('nonce').value = payload.nonce;
                        document.getElementById('payment').submit();
                    });
                }, false);
            });
        });
    </script>
{% endblock content %}
